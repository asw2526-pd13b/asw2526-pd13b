<%# embolcallem tot en l'estructura de l'HTML original %>
<div tabIndex="-1">
  <div class="home container-lg">
    <div class="row">
      <div class="col-12 col-md-8 col-lg-9">

        <div class="d-block d-md-none">
          <div class="row">
            <div class="col-12">
              <button class="btn btn-secondary d-inline-block mb-2 me-3">Barra lateral
                <svg class="icon icon-inline">
                  <use xlink:href="<%= asset_path('symbols.svg') %>#icon-plus-square"></use>
                  <div class="visually-hidden"><title>plus-square</title></div>
                </svg>
              </button>
            </div>
          </div>
        </div>

        <div class="main-content-wrapper">
          <div>
            <div class="row align-items-center mb-3 g-3">

              <div class="col-auto">
                <div class="listing-type-select btn-group btn-group-toggle flex-wrap" role="group">
                  <%= link_to "Subscrit", posts_path(params.merge(filter: "subscribed")),
                        class: "btn btn-outline-secondary #{'active' if params[:filter] == 'subscribed'} #{'disabled' unless user_signed_in?}",
                        title: "Mostra les comunitats a les quals estàs subscrit" %>
                  <%= link_to "Local", posts_path(params.merge(filter: "local")),
                        class: "btn btn-outline-secondary #{'active' if params[:filter] == 'local' || params[:filter].nil?}",
                        title: "Mostra únicament comunitats locals" %>
                </div>
              </div>

              <div class="col-auto">
                <%= form_with url: posts_path, method: :get, local: true, class: "d-inline" do |f| %>
                  <%# Passem els altres paràmetres (cerca, filtre) perquè no es perdin en canviar l'ordre %>
                  <%= hidden_field_tag :q, params[:q] if params[:q] %>
                  <%= hidden_field_tag :filter, params[:filter] if params[:filter] %>

                  <%= f.select :sort,
                        options_for_select([
                          ["Nou", "new"],
                          ["Antic", "old"],
                          ["Popular", "popular"]
                        ], params[:sort]),
                        { prompt: "Tipus d’ordenació" },
                        { class: "form-select d-inline-block w-auto me-2",
                          aria: { label: "Tipus d’ordenació" },
                          onchange: 'this.form.submit()' <%# Envia el formulari automàticament %>
                        } %>
                <% end %>
              </div>
            </div> <div class="post-listings">
              <% if @posts.any? %>
                <% @posts.each do |post| %>
                  <%# Cridem al fitxer partial _post.html.erb per cada post %>
                  <%= render 'post', post: post %>
                  <hr class="my-3">
                <% end %>
              <% else %>
                <div class="alert alert-info" role="alert">
                  No hay posts todavía.
                </div>
              <% end %>
            </div>

            <div class="paginator my-2">
              <%# Aquí aniria el teu helper de paginació (ex: Pagy, Kaminari) %>
              <button class="btn btn-secondary">Següent</button>
            </div>

          </div>
        </div>
      </div>
    </div>
  </div>
</div>